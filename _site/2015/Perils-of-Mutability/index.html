<!doctype html>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7 oldie" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="GitHub Pages" />

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <title>Perils of Mutability - FullOuterJoin</title>

  
  <meta name="title" content="Perils of Mutability" />
  <meta property="og:title" content="Perils of Mutability" />
  <meta name="description" content="Exposing the state of an object can be dangerous" />
  <meta property="og:description" content="Exposing the state of an object can be dangerous" />
  <meta property="og:site_name" content="FullOuterJoin" />
  <meta property="og:image" content="" />
  
  <meta name="author" content="vishnu" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <link rel="stylesheet" type="text/css" href="/css/libs/jquery.qtip.min.css" />

  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" /><!-- syntax highlighting -->
  <!--[if IE]>
      <link rel="stylesheet" type="text/css" href="/css/ie.css" />
  <![endif]-->

  <script src="/js/libs/modernizr-2.5.3.min.js"></script>
</head>

<body>

  <div id="container">
    <aside id="topbar">
      <div class="inner">
        <h1><a href="/">FullOuterJoin</a></h1>

        <ul id="quick-links">
          <li><a href="/">home</a></li>
          <li><a href="/about.html">about</a></li>
        </ul>
      </div>
    </aside>

    <section id="main" role="main">
      <div class="inner">
        <article id="single" class="hentry">
    <header>
        <h1 class="entry-title">
            
            Perils of Mutability
            
        </h1>
        <time datetime="2015-04-29T00:00:00-07:00">
            29 April 2015
        </time>
    </header>

    <div class="entry-content">
        <p>I was doing a course on coursera called <a href="https://www.coursera.org/course/proglang">Programming Languages</a>. Finishing that course was a turning point for me to understand how languages work and acquire the adeptness to learn a new language. I was really interested when the topic mutability was being discussed. Mutability refers to the ability to change the state of an object or a variable. A  lot of (pure) functional languages don’t even provide mutability. That means, when you create a variable, then you can’t modify the state of the variable. If you say x=1, x should remain 1 no matter what. It sometimes seems a bit too restrictive. But restrictiveness can be helpful sometimes.</p>

<p>Let’s say we have a User who is created with an username, password and default roles.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">userName</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">passWord</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span><span class="o">[]</span> <span class="n">roles</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">,</span> <span class="n">String</span> <span class="n">passWord</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">userName</span> <span class="o">=</span> <span class="n">userName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">passWord</span> <span class="o">=</span> <span class="n">passWord</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">roles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&quot;ROLE1&quot;</span><span class="o">,</span> <span class="s">&quot;ROLE2&quot;</span><span class="o">};</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getRoles</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">roles</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isAdmin</span><span class="o">(){</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">role</span> <span class="o">:</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span><span class="o">(</span><span class="n">role</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">&quot;ADMIN&quot;</span><span class="o">))</span>
                <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></div>

<p>So when ever we would want to check if the user is admin, then isAdmin() is called. The isAdmin() checks all the roles it has and decides to return true if it has some role called ADMIN.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">User</span> <span class="n">someUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="s">&quot;bar&quot;</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">roles</span> <span class="o">=</span> <span class="n">someUser</span><span class="o">.</span><span class="na">getRoles</span><span class="o">();</span>

        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">role</span> <span class="o">:</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;is someUser an Admin?  &quot;</span> <span class="o">+</span> <span class="n">someUser</span><span class="o">.</span><span class="na">isAdmin</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<div class="highlighter-rouge"><pre class="highlight"><code>Output:
ROLE1
ROLE2
is someUser an Admin? false
</code></pre>
</div>

<p>This seems like a really simple and harmless usage of User but when you do someUser.getRoles(), the reference to the string array in the someUser is returned. And with reference you can modify the values pointed by the reference.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">User</span> <span class="n">someUser</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">User</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">,</span> <span class="s">&quot;bar&quot;</span><span class="o">);</span>
        <span class="n">String</span><span class="o">[]</span> <span class="n">roles</span> <span class="o">=</span> <span class="n">someUser</span><span class="o">.</span><span class="na">getRoles</span><span class="o">();</span>

        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Roles: &quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">role</span> <span class="o">:</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;is someUser an Admin?  &quot;</span> <span class="o">+</span> <span class="n">someUser</span><span class="o">.</span><span class="na">isAdmin</span><span class="o">());</span>

        <span class="n">roles</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="s">&quot;ADMIN&quot;</span><span class="o">;</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Roles: &quot;</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">role</span> <span class="o">:</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">role</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;is someUser an Admin?  &quot;</span> <span class="o">+</span> <span class="n">someUser</span><span class="o">.</span><span class="na">isAdmin</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<div class="highlighter-rouge"><pre class="highlight"><code>Output:
Roles:
ROLE1
ROLE2
is someUser an Admin? false
Roles:
ROLE1
ADMIN
is someUser an Admin? true
</code></pre>
</div>

<p>This is something the creator of the User class wouldn’t have intended but due to mutability, we are able to change the state of an object, thus changing the behavior of User.</p>

<p>So how can we prevent it? Either the language itself should not provide mutability. But all the languages don’t. So instead of returning the reference of the state(role array) we can return a copy of its state. When we provide a copy, nobody can change the actual state(role array) of the user.</p>

<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="n">String</span><span class="o">[]</span> <span class="nf">getRoles</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">roles</span><span class="o">,</span> <span class="n">roles</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
    <span class="o">}</span></code></pre></div>

<div class="highlighter-rouge"><pre class="highlight"><code>Output:
Roles:
ROLE1
ROLE2
is someUser an Admin? false
Roles:
ROLE1
ADMIN
is someUser an Admin? false
</code></pre>
</div>

<p>Changing the copy of the roles in main does not change the actual roles in the someUser object as we are returning the copy of the roles. Small things like this could potentially inflict so much damage unless the developer is aware of the consequences of exposing the state. It is also a good OOP practise by not exposing the state of an object to the outside world.</p>

<p>More Thoughts:</p>

<p>Whenever you expose an object’s reference, anyone can make changes to the state. Consider you have a collection and when you expose it to the outside, then anyone can manipulate it like say remove all the items or add new things.</p>

<p>PS:<br />
I would recommend you to take this course <a href="https://www.coursera.org/course/proglang">Programming Languages</a>. Reason : It will blow your mind</p>


    </div>
</article>


<div id="related">
    <h2>Related Posts</h2>
    <ul class="posts">
        
        <li><span>13 Dec 2015</span> &raquo; <a href="/2015/Angular%20Js's%20weirdness/">Angular JS's ng-if and watches</a></li>
        
        <li><span>03 Oct 2015</span> &raquo; <a href="/2015/Longboarding/">Longboarding</a></li>
        
        <li><span>20 May 2015</span> &raquo; <a href="/2015/Dependency-Injection/">Dependency Injection</a></li>
        
    </ul>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'fullouterjoin';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        <footer>
	        <div class="vcard">
            <a class="email fn n" href="mailto: vishnu.carbon@gmail.com">
              <span class="given-name">vishnu</span>
            </a> &mdash; <span class="adr">
              <span class="locality">Los Angeles</span>, <span class="region">California</span> &Verbar;
              <span class="locality">Coimbatore</span>, <span class="region">Tamil Nadu</span>

            </span>
	        </div>
        </footer>
      </div>
    </section>
  </div>

  <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/1.8.3/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="/js/libs/jquery.qtip.min.js"></script>
  <script type="text/javascript" src="/js/script.js"></script>

</body>
</html>
